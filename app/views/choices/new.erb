<% if @out_of_money %>
  <div id="out-of-money" class="reveal-modal" data-reveal>
    <h2 style="color: #000;">You're out of money. EPIC FAIL</h2>
    <%= link_to "Wrap it up", finished_path(player_id: @player[:id]) %>
  </div>
  <%= javascript_tag do %>
    $(function() {
      $("#out-of-money").foundation("reveal", "open");
    });
  <% end %>
<% end %>
<% if @event %>
  <div id="event" class="reveal-modal" data-reveal>
    <h2 style="color: #000;">Some shit went down. And it cost ya.</h2>
    <a class="close-modal" onclick="$('#event').foundation('reveal', 'close')">Continue</a>
  </div>
  <%= javascript_tag do %>
    $(function() {
      $("#event").foundation("reveal", "open", {dismiss_modal_class: "close-reveal-modal"});
    });
  <% end %>
<% end %>
<div class="small-12 medium-8">
  <div class="small-12 columns radius" id="map">
  </div>
</div>
<div class="small-6 medium-4 columns" id="status">
  <div class="small-12 columns panel radius" id="trip-status">
    <h4 class="text-center">Trip Status</h4>
    <hr />
      <div id="money">
        <h6>Money</h6>
        <div class="progress radius">
            <span class="meter" style="width:<%= @money_percent %>%;background:green"></span>
        </div>
        <h6>$<%= @player[:money] %></h6>
      </div>
      <div id="progress">
        <h6>Progress</h6>
        <div class="progress radius">
            <span class="meter" style="width:<%= @progress_percent %>%;"></span>
        </div>
        <h6><%= @player[:total_miles] - @player[:miles_remaining] %> / <%= @player[:total_miles]  %> mi.</h6>
      </div>
  </div>
  <div class="small-12 columns panel radius" id="planet-status" style="display:none;">
    <h4 class="text-center">Planet Status</h4>
    <hr />
    <div class="meter-container small-4 columns">
      <div class="progress radius">
        <span class="meter"></span>
      </div>
    </div>
    <div class="meter-container small-4 columns">
      <div class="progress radius">
        <span class="meter"></span>
      </div>
    </div>
    <div class="meter-container small-4 columns">
      <div class="progress radius">
        <span class="meter"></span>
      </div>
    </div>
  </div>
</div>
<div class="small-12 medium-8 columns panel left" id="questions">
  	<p> <%= @choice[:description] %>
	<%= form_tag("/choices", method: "post") do %>
	  <%= hidden_field_tag :player_id, @player[:id]%>
	  <% @choice[:options].each do |option| %>
          <% disabled = true if option[:outcome][:cost] and @player[:money] < option[:outcome][:cost] %>
          <%= radio_button_tag :option_id, option[:id], false, required: true, disabled: disabled %>
          <% description = option[:description]  %>
          <% description += " ($#{option[:outcome][:cost]})" if option[:outcome][:cost]%>
          <% description += " (you don't have enough money!)" if disabled  %>
          <%= label_tag "option_#{option[:id]}", description, {for: 'option_id_' + option[:id].to_s}%>
	    <br/>
	  <% end %>
	  <%= submit_tag("Submit") %>
	<% end %>
</div>
<script>
	//get the map from MapBox
	var mapboxTiles = L.tileLayer('https://{s}.tiles.mapbox.com/v3/jcmorrow.ih0mmobh/{z}/{x}/{y}.png', {
	  attribution: '<a href="http://www.mapbox.com/about/maps/" target="_blank">Terms &amp; Feedback</a>'
	});

	//oriDomi because WHY THE FUCK NOT?!
	setTimeout(function(){var foldedMap = new OriDomi(document.getElementById('map'));}, 2000);
	//foldedMap.foldUp();


	//initialize the map in the #map div
	var map = L.map('map', {scrollWheelZoom:false, doubleClickZoom:false, boxZoom:false, touchZoom:false, keyboard:false, dragging:false})
	  .addLayer(mapboxTiles)
	  .setView([37.7833, -122.4167], 8);
	//new leaflet icon
	var playerIcon = L.divIcon({className:'player-icon'});
	//make new instance of that icon and add it to the map
	var playerMarker = L.marker([37.7833, -122.4167], {icon:playerIcon}).addTo(map);
	//Change the player icon color and add the player's name to it.
	$('.player-icon').append('<span style="position:relative;bottom:-10px;left:-10px;">'+window.player.name+'</span>');
	$('.player-icon').css('color', window.player.color)
	$('.player-icon').css('background-color', window.player.color)
	//empty array to push bootstrapped rails data into
	var destination_coords = [];
	//pass those in, as LatFuckingLngs no less.
	$.each(window.player.completed_choices, function(index, choice)
	{
		destination_coords.push(L.latLng([choice.location.lat, choice.location.long]));
	});
	//make the path
	var path = L.polyline(destination_coords, {color:'#661111', opacity:'.8'}).addTo(map);
</script>
